name: Deploy to GitHub Pages

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Build static site
      run: |
        # å‰µå»ºéœæ…‹ç«™é»ç›®éŒ„
        mkdir -p public-static
        
        # è¤‡è£½éœæ…‹è³‡æº
        cp -r public/* public-static/
        
        # å‰µå»ºé¦–é 
        cat > public-static/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="zh-TW">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>QR ç°½åˆ°ç³»çµ±</title>
            <style>
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                
                body {
                    font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    min-height: 100vh;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                
                .container {
                    background: white;
                    border-radius: 20px;
                    padding: 40px;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
                    text-align: center;
                    max-width: 500px;
                    width: 90%;
                }
                
                h1 {
                    color: #333;
                    margin-bottom: 20px;
                    font-size: 2.5em;
                }
                
                .subtitle {
                    color: #666;
                    margin-bottom: 30px;
                    font-size: 1.2em;
                }
                
                .button {
                    display: inline-block;
                    padding: 15px 30px;
                    margin: 10px;
                    background: linear-gradient(45deg, #667eea, #764ba2);
                    color: white;
                    text-decoration: none;
                    border-radius: 25px;
                    font-weight: bold;
                    transition: transform 0.3s ease;
                }
                
                .button:hover {
                    transform: translateY(-2px);
                }
                
                .features {
                    margin-top: 30px;
                    text-align: left;
                }
                
                .feature {
                    display: flex;
                    align-items: center;
                    margin: 15px 0;
                    color: #555;
                }
                
                .feature::before {
                    content: "âœ…";
                    margin-right: 10px;
                    font-size: 1.2em;
                }
                
                .warning {
                    background: #fff3cd;
                    border: 1px solid #ffeaa7;
                    border-radius: 10px;
                    padding: 15px;
                    margin-top: 20px;
                    color: #856404;
                }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>ğŸ¯ QR ç°½åˆ°ç³»çµ±</h1>
                <p class="subtitle">æ™ºèƒ½æ´»å‹•ç°½åˆ°è§£æ±ºæ–¹æ¡ˆ</p>
                
                <div class="features">
                    <div class="feature">å¿«é€Ÿå‰µå»ºæ´»å‹•</div>
                    <div class="feature">ç”Ÿæˆå°ˆå±¬ QR ç¢¼</div>
                    <div class="feature">å¯¦æ™‚ç°½åˆ°çµ±è¨ˆ</div>
                    <div class="feature">ç®¡ç†å“¡æ¬Šé™æ§åˆ¶</div>
                    <div class="feature">æ•¸æ“šå°å‡ºåŠŸèƒ½</div>
                </div>
                
                <div style="margin-top: 30px;">
                    <a href="#" class="button" onclick="alert('è«‹ä½¿ç”¨é›²å¹³å°éƒ¨ç½²ä»¥ç²å¾—å®Œæ•´åŠŸèƒ½')">ç«‹å³ä½¿ç”¨</a>
                    <a href="https://github.com/${{ github.repository }}" class="button" style="background: #333;">æŸ¥çœ‹æºç¢¼</a>
                </div>
                
                <div class="warning">
                    <strong>âš ï¸ æ³¨æ„ï¼š</strong><br>
                    GitHub Pages åªæ”¯æŒéœæ…‹ç¶²ç«™ã€‚è¦ç²å¾—å®Œæ•´åŠŸèƒ½ï¼ˆæ•¸æ“šåº«ã€å¾Œç«¯ APIï¼‰ï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹å¹³å°ï¼š
                    <br><br>
                    ğŸš€ <strong>æ¨è–¦éƒ¨ç½²å¹³å°ï¼š</strong><br>
                    â€¢ <a href="https://www.netlify.com" target="_blank">Netlify</a> - å…è²»ï¼Œæ”¯æŒ Node.js<br>
                    â€¢ <a href="https://vercel.com" target="_blank">Vercel</a> - é–‹ç™¼è€…å‹å¥½<br>
                    â€¢ <a href="https://render.com" target="_blank">Render</a> - æ”¯æŒæ•¸æ“šåº«<br>
                    â€¢ <a href="https://railway.app" target="_blank">Railway</a> - ç°¡å–®æ˜“ç”¨
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; color: #999;">
                    <small>Build with â¤ï¸ | GitHub Pages Version</small>
                </div>
            </div>
        </body>
        </html>
        EOF
        
        # å‰µå»º README
        cat > public-static/README.md << 'EOF'
        # QR ç°½åˆ°ç³»çµ± - GitHub Pages ç‰ˆæœ¬
        
        é€™æ˜¯ QR ç°½åˆ°ç³»çµ±çš„éœæ…‹ç‰ˆæœ¬ï¼Œè¨—ç®¡åœ¨ GitHub Pages ä¸Šã€‚
        
        ## âš ï¸ åŠŸèƒ½é™åˆ¶
        
        ç”±æ–¼ GitHub Pages åªæ”¯æŒéœæ…‹ç¶²ç«™ï¼Œä»¥ä¸‹åŠŸèƒ½ç„¡æ³•ä½¿ç”¨ï¼š
        
        - âŒ æ•¸æ“šåº«åŠŸèƒ½
        - âŒ ç”¨æˆ¶è¨»å†Š/ç™»éŒ„
        - âŒ QR ç¢¼ç”Ÿæˆ
        - âŒ ç°½åˆ°åŠŸèƒ½
        - âŒ ç®¡ç†å“¡å¾Œå°
        
        ## ğŸš€ ç²å–å®Œæ•´åŠŸèƒ½
        
        è¦ç²å¾—å®Œæ•´åŠŸèƒ½ï¼Œè«‹ä½¿ç”¨ä»¥ä¸‹å¹³å°éƒ¨ç½²ï¼š
        
        ### å…è²»å¹³å°ï¼ˆæ¨è–¦ï¼‰
        
        1. **[Netlify](https://www.netlify.com)** â­
           - ä¸€éµéƒ¨ç½²
           - æ”¯æŒ Node.js å’Œæ•¸æ“šåº«
           - å…è²» HTTPS
           - å…¨çƒ CDN
        
        2. **[Vercel](https://vercel.com)**
           - é–‹ç™¼è€…å‹å¥½
           - è‡ªå‹•éƒ¨ç½²
           - æ€§èƒ½å„ªåŒ–
        
        ### éƒ¨ç½²æ­¥é©Ÿ
        
        1. Fork é€™å€‹å€‰åº«
        2. è¨ªå• [Netlify](https://app.netlify.com)
        3. é»æ“Š "New site from Git"
        4. é¸æ“‡ä½ çš„ GitHub å€‰åº«
        5. è¨­ç½®æ§‹å»ºåƒæ•¸ï¼š
           - Build command: `npm install`
           - Publish directory: `.`
        6. é»æ“Š "Deploy"
        
        ## ğŸ“š æ–‡æª”
        
        - [è©³ç´°éƒ¨ç½²æŒ‡å—](github_deployment_guide.md)
        - [ä½¿ç”¨èªªæ˜](user_guide.md)
        - [ç³»çµ±æ¶æ§‹](README.md)
        
        ## ğŸ”§ æŠ€è¡“æ”¯æŒ
        
        å¦‚æœ‰å•é¡Œï¼Œè«‹åœ¨ GitHub Issues ä¸­æå•ã€‚
        
        ---
        
        **ğŸ¯ ç«‹å³é–‹å§‹ï¼š** é»æ“Šä¸Šé¢çš„éƒ¨ç½²å¹³å°éˆæ¥ï¼Œå¹¾åˆ†é˜å…§å³å¯æ“æœ‰åŠŸèƒ½å®Œæ•´çš„ QR ç°½åˆ°ç³»çµ±ï¼
        EOF
    
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./public-static
        publish_branch: gh-pages
        
    - name: Comment deployment URL
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      uses: actions/github-script@v6
      with:
        script: |
          const url = `https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}`;
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: `ğŸ‰ **éƒ¨ç½²æˆåŠŸï¼**\n\nğŸ“± è¨ªå•åœ°å€ï¼š${url}\n\nâš ï¸ **æ³¨æ„ï¼š** é€™æ˜¯éœæ…‹ç‰ˆæœ¬ï¼ŒåŠŸèƒ½æœ‰é™ã€‚\nğŸš€ **ç²å–å®Œæ•´åŠŸèƒ½ï¼š** ä½¿ç”¨ [Netlify](https://app.netlify.com) æˆ– [Vercel](https://vercel.com) éƒ¨ç½²ã€‚`
          });